{%extends "share/base_login.html"%}

{%block media%}
<link href="/media/css/carousel/skin.css" rel="stylesheet" type="text/css" />
<script type="text/javascript"
src="/media/js/swfobject.js">
</script>
<script src="/media/js/jquery.jcarousel.min.js" type="text/javascript"></script>
<script>
  $(function(){
    $('#carousel').jcarousel();
    $("#story-info-tabs" ).tabs();
    $('#carousel > li > img').click(function()
    {
      $("#big-img").attr("src", $(this).attr("src"));
    });
    $('#carousel > li > img:first').click();
  });
</script>
<style type="text/css">
  img {padding:0;}
  #carousel img {width:100px; height:75px;}
  #big-img-frame {background:black; width:600px;height:450px; margin:auto;}
  #big-img {max-width:600px; max-height:450px;margin:auto;display:block;}
</style>
{%endblock%}
{%block title%}故事邀请{%endblock%}
{%block content%}
<div class="span-16" id="story-info-tabs">
  <ul>
    <li><a href="#story-info-tabs-1">心情</a></li>
    <li><a href="#story-info-tabs-2">图片</a></li>
  </ul>
  <div class="span-15 last" id="story-info-tabs-1">
    {%for post in story.get_posts%}

      <div class="span-15 last"> 
        <div class="span-2">
        {%with post.post_by as person%}
          {%include "share/portrait.html"%}
        {%endwith%}
        </div>
        <div class="span-13 last">
          <hr class="space"/>
          <hr class="space"/>
          <div>说@{{post.post_date}}</div>
        </div>
      </div>
      <hr/>
      <div class="span-15 last">
        <p>{{post.content}}</p>
      </div>
      <hr/>

    {%endfor%}
    <form method="post" action="/story/post/{{story.id}}/" class="span-15 last">
      {% csrf_token %}
      <p><textarea cols="70" rows="6" name="content"></textarea></p>
      <p><input type="submit" value="发布"/></p>
    </form>
  </div>
  <div class="album-wrapper span-15 last" id="story-info-tabs-2">
    <ul class="jcarousel-skin-tango" id="carousel">
      {%for photo in story.get_photos%}
        <li><img src="{{photo.content.url}}"/></li>
      {%endfor%} 
    </ul>
    <form method="post" action="/story/uploadphoto/{{story.id}}/" enctype="multipart/form-data" class="right">
      {% csrf_token %}
      <input type="file" name="photo"/>
      <input type="submit" value="上传"/>
    </form>
    <hr class="space"/>
    <div>
      <div id="big-img-frame">
        <img id="big-img"/>
      </div>
    </div>    
  </div>
</div>

<div class="prepend-1 span-7 last" id="sidebar">  
  <div id="video">请下载安装最新版本的flash插件</div>
  <hr class="space"/>
  <script type="text/javascript">
    var flashvars = {file:'/media/video/dcd_football_2010.flv',autostart:'true' };
    var params = {allowfullscreen:'true', allowscriptaccess:'always' };
    var attributes = { id:'player1', name:'player1' };
    
    swfobject.embedSWF('/media/js/jwplayer/player.swf','video','270','200','9.0.115','false',    flashvars, params, attributes);
  </script>
  <h1>{{story.name}}</h1>
  {%with story.creator as person%}
    {%include "share/portrait.html"%}
  {%endwith%}
  <p>{{story.description}}</p>
  <hr/>
  <p>开始时间:{{story.start_time}}</p>
  <p>结束时间:{{story.end_time}}</p>
  <p>地点:{{story.activity_place}}</p>
  <p>
    <script>
      $(function(){
        $("#invite-dialog").load("/story/candidate-pan/{{story.id}}/",{'next': '/story/detail/{{story.id}}'},function(){
          $(this).dialog({
            autoOpen: false,
            height: 680,
            width: 580,
            modal: true
          });
          $("#invite").button().click(function(){
            $("#invite-dialog").dialog("open");
          });
        });
        $('#participant-pan').load("/story/participants/{{story.id}}/")
      });
    </script>
    <a href="/story/edit/{{story.id}}/">编辑</a>
  </p>
  <hr/>
  <div>
    <p>故事里的人</p>
    <p><a id="invite">邀请</a></p>
    <div id="participant-pan"></div>
  </div>
  <hr/>
  <div id="invite-dialog">
    
  </div>
</div>

{%endblock%}
{%block footer%}
{%endblock%}